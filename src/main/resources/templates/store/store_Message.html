<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>设备信息推送</title>
    <link th:href="@{https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css}" rel="stylesheet"/>
    <script th:src="@{https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js}"></script>
    <script th:src="@{https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js}"></script>
    <script>
        var page = {
            currPage: 1,
            totalPage: 0,
            pageLength: 4,
            startPage: 1,
            endPage: 4,
            pageSize: 7
        };
        $(function () {
             $.ajax({
                 url:"/store/findAll",
                 data:{"page": page.currPage, "pageSize": page.pageSize, "searchName": ""},
                 type:"GET",
                 dataType:"JSON",
                 success:function (data) {
                     page.totalPage = data.totalPages;
                     if (data.totalPages > page.pageLength) {
                         addButtons(page.startPage, page.pageLength);
                     } else {
                         addButtons(page.startPage, data.totalPages);
                     }
                     pageIteration(page.currPage);
                     isDisabled(page.currPage, data.totalPages);
                     for (var i = 0; i <data.content.length ; i++) {
                         $("tbody").append('<tr>' +
                             '<td>'+data.content[i].name+'</td>' +
                             '<td>'+data.content[i].code+'</td>' +
                             '<td>'+data.content[i].widthBand.servicePerson.serviceName+'</td>' +
                             '<td>'+data.content[i].widthBand.payMethod.method+'</td>'+
                             '<td>'+data.content[i].widthBand.endDate+'</td>'+
                             '<td><B>推送消息</B></td>'+
                             '</tr>')
                     }
                 },
                 error:function () {
                     alert("餐厅信息加载失败");
                 }
             });
         })
        //添加分页插件，根据总页数来添加按钮
        function addButtons(startPage, pageLength) {
            $("#page").html(" ");
            var _html = "<center><button class='btn btn-default prev' ><<上一页</button> ";
            for (var i = startPage; i < startPage + pageLength; i++) {
                _html += "<button class='btn btn-default page-btn' data-pageno=" + i + ">" + i + "</button> ";
            }
            _html += " <button class='btn btn-default next'>下一页>></button></center>";
            $("#page").html(_html);
        }
        //分页按钮迭代(最要是对"上一页"和”下一页“是否禁用的判断)
        function isDisabled(pagenum, totalpage) {
            if (totalpage == 0 || totalpage == 1) {
                $("#page .prev").attr("disabled", true);
                $("#page .next").attr("disabled", true);
            } else if (pagenum == 1) {
                $("#page .prev").attr("disabled", true);
                $("#page .next").removeAttr("disabled");
            } else if (pagenum == totalpage) {
                $("#page .next").attr("disabled", true);
                $("#page .prev").removeAttr("disabled");
            } else {
                $("#page .next").removeAttr("disabled");
                $("#page .prev").removeAttr("disabled");
            }
        }
        //按钮迭代器
        function pageIteration(currPage) {
            if (page.currPage != 1 && page.currPage == page.startPage) {
                page.startPage = page.currPage - page.pageLength / 2;
                page.endPage = page.currPage + page.pageLength / 2 - 1;
                addButtons(page.startPage, page.pageLength);
                $("#page .page-btn").eq(page.pageLength / 2).addClass("curr-page");
            } else if (page.currPage != page.totalPage && page.currPage == page.endPage) {
                page.startPage = page.currPage - page.pageLength / 2 + 1;
                page.endPage = (page.currPage + page.pageLength / 2) >= page.totalPage ? page.totalPage : (page.currPage + page.pageLength / 2);
                addButtons(page.startPage, page.pageLength / 2 + (page.endPage == page.totalPage ? (page.endPage - page.currPage) : page.pageLength / 2));
                $("#page .page-btn").eq(page.pageLength / 2 - 1).addClass("curr-page");
            }
            $("#page .page-btn").removeClass("curr-page").parent().find("[data-pageno=" + currPage + "]").addClass("curr-page");
        }
    </script>
</head>
<body>
<div class="container">
    <div th:include="/common/header :: html"></div>
    <div class="col-md-7 col-xs-12"></div>
    <div class="col-md-5 col-xs-12">
        <div class="input-group">
            <input type="text" id="search" class="form-control" placeholder="输入门店名称进行搜索">
            <span class="input-group-btn">
                 <button class="btn btn-primary" id="searchButton">搜 索</button>
            </span>
        </div>
    </div>
    <table class="table table-striped">
        <caption>设备列表信息展示</caption>
        <thead>
        <tr>
            <th>门店名称</th>
            <th>门店编码</th>
            <th>运营商</th>
            <th>付款方式</th>
            <th>到期日期</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

</body>
</html>